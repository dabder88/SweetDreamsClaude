# Общая логика генерации (General Logic)

Анализ сновидения в приложении Mindscape происходит в два последовательных этапа для обеспечения глубины и объема текста.

## Базовая Системная Инструкция
Для всех запросов используется следующая базовая установка личности ИИ:
> "Ты — эксперт-психолог. Пиши структурированно, без воды. Строго соблюдай JSON формат."

---

## ЭТАП 1: Структура и Глубинный Анализ

На этом этапе ИИ получает полный контекст сна и формирует "скелет" ответа, а также проводит общий психоанализ ситуации.

**Входные данные:**
*   Текст сна (до 3000 символов)
*   Эмоция
*   Жизненная ситуация
*   Ассоциации
*   Дневной остаток (Day Residue)
*   Тип персонажей
*   Роль во сне (Наблюдатель/Герой и т.д.)
*   Телесные ощущения (Психосоматика)
*   *Специфический промпт метода* (см. отдельные файлы методов)

**Задача ИИ:**
1.  Сформировать `summary` (краткая суть).
2.  Провести `analysis` (ГЛУБОКИЙ анализ всей ситуации, 4-5 блоков, с учетом роли и тела).
3.  Дать `advice` (3 совета) и `questions` (3 вопроса).
4.  Выделить `symbol_names` (массив названий ключевых символов для следующего этапа).

**Температура:** 0.4 (Более строгая и логичная генерация).

---

## ЭТАП 2: Детализация Символов (Параллельные запросы)

Для каждого символа, найденного на Этапе 1, отправляется отдельный запрос. Это позволяет обойти лимиты токенов и получить большой объем текста (3-4 абзаца) на каждый символ.

**Промпт для каждого символа:**
> АНАЛИЗ СИМВОЛА: "{Название Символа}"
>
> ПОЛНЫЙ КОНТЕКСТ СНА: "{Текст сна}"
> ЖИЗНЕННАЯ СИТУАЦИЯ: {Текст}
> РОЛЬ ВО СНЕ: {Роль}
> ТЕЛЕСНЫЕ ОЩУЩЕНИЯ: {Ощущения}
> ЭМОЦИЯ: {Эмоция}
>
> ЗАДАЧА:
> Напиши МАКСИМАЛЬНО ПОДРОБНОЕ толкование символа "{Название}" в контексте этого сна и состояния человека.
>
> ТРЕБОВАНИЯ:
> 1. ЯЗЫК: ТОЛЬКО РУССКИЙ.
> 2. ОБЪЕМ: 3-4 развернутых абзаца (минимум 800 знаков).
> 3. ФОРМАТ: JSON { "name": "{Название}", "meaning": "текст..." }

**Температура:** 0.5 (Баланс между точностью и богатством языка).
