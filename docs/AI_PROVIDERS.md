# AI PROVIDERS - –°–∏—Å—Ç–µ–º–∞ AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

> **Summary:** PsyDream –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤, –ø–æ–∑–≤–æ–ª—è—é—â—É—é –ø–æ–¥–∫–ª—é—á–∞—Ç—å –ª—é–±—ã–µ AI –º–æ–¥–µ–ª–∏ (Gemini, OpenAI, Claude, AiTunnel, NeuroAPI –∏ –¥—Ä—É–≥–∏–µ) –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å–Ω–æ–≤ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –≤—ã–±–∏—Ä–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∑–∞–¥–∞—á (–∞–Ω–∞–ª–∏–∑ —Å–Ω–æ–≤) –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

---

## ‚ö†Ô∏è –í–ê–ñ–ù–û: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Å–∏—Å—Ç–µ–º–µ AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** –æ–±–Ω–æ–≤–ª—è–π —ç—Ç–æ—Ç —Ñ–∞–π–ª –∏ [CLAUDE.md](../CLAUDE.md).

**–ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ (–Ω–æ–≤—ã–π –∫–ª–∞—Å—Å –≤ `/services/ai/providers/`)
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ AIService –∏–ª–∏ AIProviderFactory
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö `ai_provider_configs` –∏–ª–∏ `ai_models`
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ª–æ–≥–∏–∫–µ –≤—ã–±–æ—Ä–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –¥–ª—è text/image –∑–∞–¥–∞—á
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö capabilities –¥–ª—è –º–æ–¥–µ–ª–µ–π

---

## üìã –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

PsyDream –ù–ï –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (Gemini, OpenAI, Claude, etc.). –°–∏—Å—Ç–µ–º–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–µ **Factory + Strategy**, –ø–æ–∑–≤–æ–ª—è—é—â–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –∏–∑ –ë–î –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ —á–µ—Ä–µ–∑ –µ–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.

**–ö–ª—é—á–µ–≤–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:** –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –Ω–∞–∑–Ω–∞—á–∏—Ç—å **—Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤** –¥–ª—è:
- **Text tasks** (–∞–Ω–∞–ª–∏–∑ —Å–Ω–æ–≤, –æ—Ç—á—ë—Ç—ã) - –Ω–∞–ø—Ä–∏–º–µ—Ä, Claude Sonnet
- **Image tasks** (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π) - –Ω–∞–ø—Ä–∏–º–µ—Ä, DALL-E 3

---

## üèóÔ∏è –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### 1. AIService (Singleton) - [services/ai/aiService.ts](../services/ai/aiService.ts)

**–ì–ª–∞–≤–Ω—ã–π —Å–µ—Ä–≤–∏—Å** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å AI. –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç —á–µ—Ä–µ–∑ –Ω–µ–≥–æ.

```typescript
import { aiService } from './services/ai/aiService';

// –ê–Ω–∞–ª–∏–∑ —Å–Ω–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –¥–ª—è —Ç–µ–∫—Å—Ç–∞)
const analysis = await aiService.analyzeDream(dreamData);

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
const imageUrl = await aiService.generateImage(prompt);
```

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

1. **–ó–∞–≥—Ä—É–∑–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞:**
   - –ü—Ä–∏ –≤—ã–∑–æ–≤–µ `analyzeDream()` –∏–ª–∏ `generateImage()` AIService –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –∫–∞–∫–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä –∞–∫—Ç–∏–≤–µ–Ω –¥–ª—è —ç—Ç–æ–≥–æ —Ç–∏–ø–∞ –∑–∞–¥–∞—á–∏
   - –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∏–∑ –ë–î —Ç–∞–±–ª–∏—Ü—É `ai_provider_configs` –ø–æ –ø–æ–ª—è–º:
     - `is_active_for_text = true` - –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∑–∞–¥–∞—á
     - `is_active_for_images = true` - –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç –º–æ–¥–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:
     - `default_model_id_for_text` - –¥–ª—è —Ç–µ–∫—Å—Ç–∞
     - `default_model_id_for_images` - –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

2. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã –∫—ç—à–∏—Ä—É—é—Ç—Å—è –Ω–∞ **1 –º–∏–Ω—É—Ç—É** (–æ—Ç–¥–µ–ª—å–Ω–æ –¥–ª—è text –∏ image)
   - –≠—Ç–æ –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î
   - –ö—ç—à –º–æ–∂–Ω–æ —Å–±—Ä–æ—Å–∏—Ç—å —á–µ—Ä–µ–∑ `aiService.clearCache()`

3. **–°–æ–∑–¥–∞–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞:**
   - –ü–µ—Ä–µ–¥–∞—ë—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ AIProviderFactory
   - Factory —Å–æ–∑–¥–∞—ë—Ç –Ω—É–∂–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä (GeminiProvider, OpenAIProvider, ClaudeProvider)
   - –ü—Ä–æ–≤–∞–π–¥–µ—Ä –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**

| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| `analyzeDream(dreamData)` | –ê–Ω–∞–ª–∏–∑ —Å–Ω–∞ —á–µ—Ä–µ–∑ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ text-–ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ |
| `generateImage(prompt)` | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ image-–ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ |
| `getActiveProviderInfo(taskType)` | –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä–µ |
| `clearCache(taskType?)` | –°–±—Ä–æ—Å–∏—Ç—å –∫—ç—à –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ |
| `testConnection(taskType)` | –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—É |

---

### 2. AIProviderFactory - [services/ai/AIProviderFactory.ts](../services/ai/AIProviderFactory.ts)

**–§–∞–±—Ä–∏–∫–∞** –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ `provider_type`.

```typescript
const provider = AIProviderFactory.create(config, model);
```

**–ú–∞–ø–ø–∏–Ω–≥ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤:**

| provider_type | –ö–ª–∞—Å—Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|---------------|------------------|------------|
| `gemini` | GeminiProvider | Google Gemini AI |
| `openai` | OpenAIProvider | OpenAI API |
| `aitunnel` | OpenAIProvider | OpenAI-compatible API (AiTunnel) |
| `neuroapi` | OpenAIProvider | OpenAI-compatible API (NeuroAPI) |
| `claude` | ClaudeProvider | Anthropic Claude |
| `custom` | OpenAIProvider | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é OpenAI-compatible) |

**–ö–ª—é—á–µ–≤–æ–π –∏–Ω—Å–∞–π—Ç:** `openai`, `aitunnel`, `neuroapi` –∏—Å–ø–æ–ª—å–∑—É—é—Ç **–æ–¥–∏–Ω –∫–ª–∞—Å—Å** OpenAIProvider, –Ω–æ —Å —Ä–∞–∑–Ω—ã–º–∏ `base_url`:
- OpenAI: `https://api.openai.com/v1`
- AiTunnel: `https://api.aitunnel.ru/v1`
- NeuroAPI: `https://neuroapi.host/v1`

---

### 3. BaseProvider (Abstract) - [services/ai/providers/BaseProvider.ts](../services/ai/providers/BaseProvider.ts)

**–ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å** –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ–±—â–∏–µ –º–µ—Ç–æ–¥—ã:

```typescript
export abstract class BaseProvider {
  // –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã (—Ä–µ–∞–ª–∏–∑—É—é—Ç—Å—è –≤ –ø–æ–¥–∫–ª–∞—Å—Å–∞—Ö)
  abstract analyzeDream(dreamData: DreamData): Promise<AnalysisResponse>;
  abstract generateImage(prompt: string): Promise<string>;

  // –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã
  protected getApiKey(): string { ... }
  protected buildPrompt(dreamData: DreamData): string { ... }
  protected validateResponse(response: any): AnalysisResponse { ... }
  protected getModelConfig() { ... }
}
```

**–û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã:**

| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| `getApiKey()` | –ü–æ–ª—É—á–∞–µ—Ç API –∫–ª—é—á –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è (config.api_key_env_name) |
| `buildPrompt()` | –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å–Ω–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–µ—Ç–æ–¥–∞ (jungian, freudian, etc.) |
| `validateResponse()` | –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç AI –∏ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ `AnalysisResponse` —Ñ–æ—Ä–º–∞—Ç—É |
| `getModelConfig()` | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–¥–µ–ª–∏ (temperature, max_tokens, top_p) –∏–∑ model.model_config –∏–ª–∏ provider.config |

---

### 4. –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã

#### GeminiProvider - [services/ai/providers/GeminiProvider.ts](../services/ai/providers/GeminiProvider.ts)

**Google Gemini AI** —Å –¥–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–º –∞–Ω–∞–ª–∏–∑–æ–º —Å–Ω–æ–≤.

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫—É `@google/genai`
- **Stage 1:** –ü–æ–ª—É—á–∞–µ—Ç summary, analysis, advice, questions, symbol_names (–æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º)
- **Stage 2:** –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —Å–∏–º–≤–æ–ª–∞
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç structured output (JSON schema) –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞
- Auto-repair –¥–ª—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ JSON

**–ê–Ω–∞–ª–∏–∑ —Å–Ω–∞:**
```typescript
async analyzeDream(dreamData: DreamData): Promise<AnalysisResponse>
```
- –ú–æ–¥–µ–ª—å –∏–∑ `model.model_id` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `gemini-2.0-flash-exp`)
- Temperature, max_tokens –∏–∑ `getModelConfig()`

**–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:**
```typescript
async generateImage(prompt: string): Promise<string>
```
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –º–æ–¥–µ–ª—å –∏–∑ `model.model_id` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `gemini-2.0-flash-exp` –∏–ª–∏ –¥—Ä—É–≥—É—é, –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –¥–ª—è image task)
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç base64 data URL: `data:image/png;base64,...`

---

#### OpenAIProvider - [services/ai/providers/OpenAIProvider.ts](../services/ai/providers/OpenAIProvider.ts)

**–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä** –¥–ª—è OpenAI-compatible APIs (OpenAI, AiTunnel, NeuroAPI).

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫—É `openai`
- `baseURL` –±–µ—Ä—ë—Ç—Å—è –∏–∑ `config.base_url`
- **Stage 1 + Stage 2:** –î–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫–∞–∫ —É Gemini
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `response_format: { type: 'json_object' }`

**–ê–Ω–∞–ª–∏–∑ —Å–Ω–∞:**
```typescript
async analyzeDream(dreamData: DreamData): Promise<AnalysisResponse>
```
- –ú–æ–¥–µ–ª—å –∏–∑ `model.model_id` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `gpt-5-mini`, `claude-sonnet-4-5`)
- Stage 1: summary, analysis, advice, questions, symbol_names
- Stage 2: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å–∏–º–≤–æ–ª–æ–≤

**–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:**
```typescript
async generateImage(prompt: string): Promise<string>
```
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `client.images.generate()`
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–æ–¥–µ–ª–∏ —Å `capabilities.image = true`
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ `model.model_config`: size, quality
- –§–æ—Ä–º–∞—Ç—ã: `b64_json` (–ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ) –∏–ª–∏ `url` (fallback)
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç base64 data URL

---

#### ClaudeProvider - [services/ai/providers/ClaudeProvider.ts](../services/ai/providers/ClaudeProvider.ts)

**Anthropic Claude** –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å–Ω–æ–≤.

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Anthropic API
- –î–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–π –∞–Ω–∞–ª–∏–∑
- –ü–æ–∫–∞ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (Claude –Ω–µ –∏–º–µ–µ—Ç image generation)

---

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞: ai_provider_configs

–•—Ä–∞–Ω–∏—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤—Å–µ—Ö –ø–æ–¥–∫–ª—é—á—ë–Ω–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤.

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | UUID | Primary key |
| `provider_type` | TEXT | –¢–∏–ø –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (unique): `gemini`, `openai`, `claude`, `aitunnel`, `neuroapi`, `custom` |
| `provider_name` | TEXT | –ò–º—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, "Google Gemini", "OpenAI") |
| `is_active` | BOOLEAN | **Legacy:** –ê–∫—Ç–∏–≤–µ–Ω –ª–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä –≥–ª–æ–±–∞–ª—å–Ω–æ (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è) |
| `is_active_for_text` | BOOLEAN | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∑–∞–¥–∞—á (–∞–Ω–∞–ª–∏–∑ —Å–Ω–æ–≤) |
| `is_active_for_images` | BOOLEAN | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π |
| `api_key_env_name` | TEXT | –ò–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å API –∫–ª—é—á–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, `VITE_OPENAI_API_KEY`) |
| `base_url` | TEXT | Base URL –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤ (–¥–ª—è OpenAI-compatible) |
| `default_model_id` | UUID | **Legacy:** –ú–æ–¥–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è) |
| `default_model_id_for_text` | UUID | ‚úÖ –ú–æ–¥–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∑–∞–¥–∞—á (FK ‚Üí ai_models.id) |
| `default_model_id_for_images` | UUID | ‚úÖ –ú–æ–¥–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (FK ‚Üí ai_models.id) |
| `config` | JSONB | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: `{ temperature, max_tokens, top_p, ... }` |
| `created_at` | TIMESTAMPTZ | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |
| `updated_at` | TIMESTAMPTZ | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |

**RLS:** Enabled (–∑–∞—â–∏—â–µ–Ω–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î)

---

### –¢–∞–±–ª–∏—Ü–∞: ai_models

–•—Ä–∞–Ω–∏—Ç –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏ AI (175+ –∑–∞–ø–∏—Å–µ–π).

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | UUID | Primary key |
| `provider_type` | TEXT | –¢–∏–ø –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (`gemini`, `openai`, `claude`, etc.) |
| `model_id` | TEXT | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –º–æ–¥–µ–ª–∏ –¥–ª—è API (–Ω–∞–ø—Ä–∏–º–µ—Ä, `gpt-5-mini`, `claude-sonnet-4-5`) |
| `model_name` | TEXT | –ß–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º–æ–µ –∏–º—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, "GPT-5 Mini", "Claude Sonnet 4.5") |
| `provider_name` | TEXT | –ò–º—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "OpenAI", "Anthropic", "Google") |
| `capabilities` | JSONB | `{ text: boolean, image: boolean, reasoning: boolean }` |
| `pricing` | JSONB | `{ input: number, output: number, currency: string, per: string }` |
| `performance` | JSONB | `{ intelligence: string, speed: string }` |
| `context_length` | INTEGER | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–≤ —Ç–æ–∫–µ–Ω–∞—Ö) |
| `is_available` | BOOLEAN | –î–æ—Å—Ç—É–ø–Ω–∞ –ª–∏ –º–æ–¥–µ–ª—å |
| `model_config` | JSONB | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–¥–µ–ª–∏: `{ temperature, max_tokens, top_p, size, quality, ... }` |
| `created_at` | TIMESTAMPTZ | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |

**RLS:** Enabled

**Capabilities:**
- `text: true` - –ú–æ–¥–µ–ª—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é (–∞–Ω–∞–ª–∏–∑ —Å–Ω–æ–≤)
- `image: true` - –ú–æ–¥–µ–ª—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- `reasoning: true` - –ú–æ–¥–µ–ª—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –º—ã—à–ª–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, o1, o3)

---

## üîß –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

–°–æ–∑–¥–∞–π –Ω–æ–≤—ã–π —Ñ–∞–π–ª `/services/ai/providers/YourProvider.ts`:

```typescript
import { BaseProvider } from './BaseProvider';
import type { DreamData, AnalysisResponse } from '../../../types';

export class YourProvider extends BaseProvider {
  async analyzeDream(dreamData: DreamData): Promise<AnalysisResponse> {
    // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞ —á–µ—Ä–µ–∑ —Ç–≤–æ–π API
    const apiKey = this.getApiKey();
    const modelConfig = this.getModelConfig();

    // –ó–∞–ø—Ä–æ—Å –∫ API...
    const response = await yourApi.analyze({
      model: this.model.model_id,
      prompt: this.buildPrompt(dreamData),
      temperature: modelConfig.temperature,
      max_tokens: modelConfig.max_tokens
    });

    return this.validateResponse(response);
  }

  async generateImage(prompt: string): Promise<string> {
    // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    const apiKey = this.getApiKey();

    // –ó–∞–ø—Ä–æ—Å –∫ API...
    const response = await yourApi.generateImage({
      model: this.model.model_id,
      prompt: prompt
    });

    return response.imageUrl; // base64 data URL
  }
}
```

### –®–∞–≥ 2: –î–æ–±–∞–≤–∏—Ç—å –≤ AIProviderFactory

–û–±–Ω–æ–≤–∏ `/services/ai/AIProviderFactory.ts`:

```typescript
import { YourProvider } from './providers/YourProvider';

export class AIProviderFactory {
  static create(config: AIProviderConfig, model: AIModel): BaseProvider {
    switch (config.provider_type) {
      // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–µ–π—Å—ã

      case 'yourprovider':
        return new YourProvider(config, model);

      default:
        throw new Error(`Unknown provider type: ${config.provider_type}`);
    }
  }
}
```

### –®–∞–≥ 3: –î–æ–±–∞–≤–∏—Ç—å –≤ –ë–î

#### 3.1. –û–±–Ω–æ–≤–∏—Ç—å —Ç–∏–ø—ã –≤ [types.ts](../types.ts):

```typescript
export type AIProviderType = 'gemini' | 'openai' | 'claude' | 'aitunnel' | 'neuroapi' | 'yourprovider' | 'custom';
```

#### 3.2. –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é `/supabase/migrations/YYYYMMDD_add_yourprovider.sql`:

```sql
-- Add provider config
INSERT INTO ai_provider_configs (
  provider_type,
  provider_name,
  api_key_env_name,
  base_url,
  is_active_for_text,
  is_active_for_images
) VALUES (
  'yourprovider',
  'Your Provider Name',
  'VITE_YOURPROVIDER_KEY',
  'https://api.yourprovider.com/v1',
  false,
  false
);

-- Add models
INSERT INTO ai_models (
  provider_type,
  model_id,
  model_name,
  provider_name,
  capabilities,
  pricing,
  performance,
  context_length,
  model_config
) VALUES
(
  'yourprovider',
  'your-model-v1',
  'Your Model v1',
  'Your Provider Name',
  '{"text": true, "image": false, "reasoning": false}'::jsonb,
  '{"input": 0.5, "output": 1.5, "currency": "USD", "per": "1M tokens"}'::jsonb,
  '{"intelligence": "high", "speed": "fast"}'::jsonb,
  128000,
  '{"temperature": 0.4, "max_tokens": 8192}'::jsonb
);
```

### –®–∞–≥ 4: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

```bash
# –ß–µ—Ä–µ–∑ Supabase CLI –∏–ª–∏ UI
supabase db push

# –ò–ª–∏ —á–µ—Ä–µ–∑ mcp__supabase__apply_migration
```

### –®–∞–≥ 5: –î–æ–±–∞–≤–∏—Ç—å API –∫–ª—é—á –≤ .env

```bash
VITE_YOURPROVIDER_KEY=your_api_key_here
```

### –®–∞–≥ 6: –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

1. –ü–µ—Ä–µ–π–¥–∏ –≤ **Admin Panel** ‚Üí **AI Providers**
2. –ù–∞–π–¥–∏ —Å–≤–æ–µ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
3. –í—ã–±–µ—Ä–∏ –º–æ–¥–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è text/image
4. –ê–∫—Ç–∏–≤–∏—Ä—É–π –¥–ª—è –Ω—É–∂–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∑–∞–¥–∞—á (`is_active_for_text`, `is_active_for_images`)

---

## üéØ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ

### –ê–Ω–∞–ª–∏–∑ —Å–Ω–∞

```typescript
import { aiService } from './services/ai/aiService';

const analysis = await aiService.analyzeDream({
  description: '–Ø –≤–∏–¥–µ–ª —Å–æ–Ω –ø—Ä–æ –ø–æ–ª—ë—Ç...',
  context: {
    emotion: '–†–∞–¥–æ—Å—Ç—å',
    lifeSituation: '–°–º–µ–Ω–∏–ª —Ä–∞–±–æ—Ç—É',
    associations: '–°–≤–æ–±–æ–¥–∞',
    recurring: false,
    dayResidue: '–°–º–æ—Ç—Ä–µ–ª —Ñ–∏–ª—å–º –ø—Ä–æ –ø—Ç–∏—Ü',
    characterType: '–ù–µ–∑–Ω–∞–∫–æ–º—Ü—ã',
    dreamRole: '–ê–∫—Ç–∏–≤–Ω—ã–π —É—á–∞—Å—Ç–Ω–∏–∫',
    physicalSensation: '–õ—ë–≥–∫–æ—Å—Ç—å'
  },
  method: 'jungian'
});

console.log(analysis.summary); // –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ
console.log(analysis.analysis); // –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑
console.log(analysis.symbolism); // –°–∏–º–≤–æ–ª—ã
console.log(analysis.advice); // –°–æ–≤–µ—Ç—ã
console.log(analysis.questions); // –í–æ–ø—Ä–æ—Å—ã –¥–ª—è —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏
```

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

```typescript
import { aiService } from './services/ai/aiService';

const imageUrl = await aiService.generateImage(
  'Surreal dream landscape with floating islands and glowing moon'
);

console.log(imageUrl); // data:image/png;base64,...
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

```typescript
// –î–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∑–∞–¥–∞—á
const textProviderInfo = await aiService.getActiveProviderInfo('text');
console.log(textProviderInfo.config.provider_name); // "OpenAI"
console.log(textProviderInfo.model.model_name); // "GPT-5 Mini"

// –î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
const imageProviderInfo = await aiService.getActiveProviderInfo('image');
console.log(imageProviderInfo.config.provider_name); // "Google Gemini"
console.log(imageProviderInfo.model.model_name); // "Gemini 2.0 Flash"
```

### –°–±—Ä–æ—Å –∫—ç—à–∞

```typescript
// –°–±—Ä–æ—Å–∏—Ç—å –∫—ç—à –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
aiService.clearCache('text');

// –°–±—Ä–æ—Å–∏—Ç—å –∫—ç—à –¥–ª—è image –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
aiService.clearCache('image');

// –°–±—Ä–æ—Å–∏—Ç—å –≤–µ—Å—å –∫—ç—à
aiService.clearCache();
```

---

## üîç Troubleshooting

### –û—à–∏–±–∫–∞: "API key not found"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å API –∫–ª—é—á–æ–º.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å `.env` —Ñ–∞–π–ª
2. –£–±–µ–¥–∏—Å—å, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `VITE_` (–¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞)
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ dev server –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ `.env`

### –û—à–∏–±–∫–∞: "No active provider for text/images"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–∏ –æ–¥–∏–Ω –ø—Ä–æ–≤–∞–π–¥–µ—Ä –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –¥–ª—è —ç—Ç–æ–≥–æ —Ç–∏–ø–∞ –∑–∞–¥–∞—á–∏.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü–µ—Ä–µ–π–¥–∏ –≤ **Admin Panel** ‚Üí **AI Providers**
2. –ê–∫—Ç–∏–≤–∏—Ä—É–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –¥–ª—è –Ω—É–∂–Ω–æ–≥–æ —Ç–∏–ø–∞ –∑–∞–¥–∞—á–∏
3. –£–±–µ–¥–∏—Å—å, —á—Ç–æ –≤—ã–±—Ä–∞–Ω–∞ –º–æ–¥–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

### –û—à–∏–±–∫–∞: "Model does not support image generation"

**–ü—Ä–∏—á–∏–Ω–∞:** –ú–æ–¥–µ–ª—å –Ω–µ –∏–º–µ–µ—Ç `capabilities.image = true`.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å `ai_models` —Ç–∞–±–ª–∏—Ü—É - —É –º–æ–¥–µ–ª–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `capabilities.image = true`
2. –í—ã–±–µ—Ä–∏ –¥—Ä—É–≥—É—é –º–æ–¥–µ–ª—å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

### –ü—Ä–æ–≤–∞–π–¥–µ—Ä –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–æ–≤–∞–π–¥–µ—Ä –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ `ai_provider_configs` —Ç–∞–±–ª–∏—Ü—É.

**–†–µ—à–µ–Ω–∏–µ:**
1. –°–æ–∑–¥–∞–π –º–∏–≥—Ä–∞—Ü–∏—é —Å INSERT –≤ `ai_provider_configs`
2. –ü—Ä–∏–º–µ–Ω–∏ –º–∏–≥—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ Supabase
3. –û–±–Ω–æ–≤–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

---

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [DATABASE.md](DATABASE.md) - –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ö–µ–º–∞ –ë–î
- [ADMIN_PANEL.md](ADMIN_PANEL.md) - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
- [DREAM_ANALYSIS.md](DREAM_ANALYSIS.md) - –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–Ω–∞–ª–∏–∑ —Å–Ω–æ–≤
- [CLAUDE.md](../CLAUDE.md) - –ì–ª–∞–≤–Ω—ã–π –∏–Ω–¥–µ–∫—Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
